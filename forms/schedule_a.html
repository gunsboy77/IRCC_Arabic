<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>النموذج A - الخلفية / الإقرار (IMM 5669) — نسخة عربية نهائية</title>
  <style>
    body{font-family:"Segoe UI",Tahoma,Arial,sans-serif;padding:20px;background:#f7f7f8;color:#111}
    .container{max-width:1000px;margin:0 auto;background:#fff;padding:18px;border-radius:8px;box-shadow:0 6px 20px rgba(0,0,0,0.05)}
    h1{font-size:1.4rem;margin-bottom:6px}
    table{width:100%;border-collapse:collapse;margin-top:10px}
    th,td{border:1px solid #d0d0d3;padding:6px;vertical-align:top}
    th{background:#eef0f6;text-align:right}
    input,select,textarea{width:100%;border:none;padding:6px}
    textarea{min-height:60px}
    .actions{margin-top:14px;display:flex;gap:8px;flex-wrap:wrap}
    button{padding:8px 12px;border:none;border-radius:6px;cursor:pointer}
    .primary{background:#0b5fff;color:#fff}
    .muted{background:#eef0f6}
    .saved-list{margin-top:10px;max-height:200px;overflow:auto;border:1px dashed #ccc;padding:6px;border-radius:6px}
    .saved-item{padding:4px;border-bottom:1px solid #eee;display:flex;justify-content:space-between;align-items:center}
  </style>
</head>
<body>
<div class="container rtl" id="formContainer">
  <h1>النموذج A — الخلفية / الإقرار (IMM 5669) — نسخة عربية</h1>

  <table>
    <tr><th>هل أنت:</th>
      <td>
        <select id="applicantType">
          <option value="principal">المتقدّم الأساسي</option>
          <option value="spouse">الزوج/الزوجة أو الشريك/الطفل المعال</option>
        </select>
      </td>
    </tr>
    <tr><th>1. الاسم الكامل</th>
      <td>
        <input id="familyName" placeholder="اسم العائلة">
        <input id="givenNames" placeholder="الأسماء">
      </td>
    </tr>
    <tr><th>2. اسمك بلغتك الأم</th><td><input id="nativeScript"></td></tr>
    <tr><th>3. تاريخ الميلاد</th><td><input id="dob" type="date"></td></tr>
    <tr><th>4. بيانات الأب</th>
      <td>
        <input id="fatherFamily" placeholder="اسم العائلة">
        <input id="fatherGiven" placeholder="الأسماء">
        <input id="fatherDob" type="date" placeholder="تاريخ الميلاد">
        <input id="fatherPOB" placeholder="مكان الميلاد">
      </td>
    </tr>
    <tr><th>5. بيانات الأم</th>
      <td>
        <input id="motherFamily" placeholder="اسم العائلة عند الميلاد">
        <input id="motherGiven" placeholder="الأسماء">
        <input id="motherDob" type="date">
        <input id="motherPOB" placeholder="مكان الميلاد">
      </td>
    </tr>
    <tr><th>6. أسئلة (نعم/لا)</th>
      <td>
        <label>هل سبق وأدينت بجريمة في كندا؟</label><select id="q6a"><option>لا</option><option>نعم</option></select>
        <label>هل أدينت في بلدان أخرى؟</label><select id="q6b"><option>لا</option><option>نعم</option></select>
        <label>هل قدّمت طلب لجوء؟</label><select id="q6c"><option>لا</option><option>نعم</option></select>
        <textarea id="q6details" placeholder="تفاصيل إذا نعم"></textarea>
      </td>
    </tr>
    <tr><th>7. التعليم</th>
      <td>
        <input id="yearsPrimary" placeholder="سنوات التعليم الأساسي">
        <input id="yearsSecondary" placeholder="سنوات التعليم الثانوي">
        <textarea id="educationDetails" placeholder="تفاصيل التعليم بعد الثانوي"></textarea>
      </td>
    </tr>
    <tr><th>8. التاريخ الشخصي <p> العشر سنين الماضية</p></th>
      <td>
        <table id="historyTable">
          <tr><th>من</th><th>إلى</th><th>النشاط</th><th>المدينة/البلد</th><th>الجهة</th><th>حذف</th></tr>
        </table>
        <button class="muted" id="addHistory">+ أضف سجل</button>
      </td>
    </tr>
    <tr><th>9. الخدمة العسكرية</th>
      <td>
        <table id="militaryTable">
          <tr><th>من</th><th>إلى</th><th>الرتبة</th><th>الوحدة/الفرع</th><th>البلد</th><th>حذف</th></tr>
        </table>
        <button class="muted" id="addMilitary">+ أضف خدمة عسكرية</button>
        <textarea id="militaryDetails" placeholder="تفاصيل إضافية"></textarea>
      </td>
    </tr>
    <tr><th>12. العناوين <p> العشر سنين الماضية</p></th>
      <td>
        <table id="addressTable">
          <tr><th>من</th><th>إلى</th><th>الشارع</th><th>المدينة</th><th>المقاطعة</th><th>الرمز</th><th>البلد</th><th>حذف</th></tr>
        </table>
        <button class="muted" id="addAddress">+ أضف عنوان</button>
      </td>
    </tr>
  </table>

  <div class="actions">
    <p>الرجاء اضافة أسم الشخص وعمل حفظ للملف إذ كنت تريد إكمال المعلومات وعند إكمال المعلومات إحفظ الملف كPDF </p>
    <input id="userId" placeholder="إسم الشخص الأول بالإنجليزي">
    <button class="primary" id="saveBtn">احفظ</button>
    <button class="muted" id="loadBtn">تحميل</button>
    <button class="muted" id="exportPdf">PDF</button>
    <!--button class="muted" id="exportDoc">Word</button-->
    <button class="muted" id="exportJson">JSON</button>
  </div>
  <div id="savedList" class="saved-list"></div>
</div>

<script>
function collectData(){
  const inputs=document.querySelectorAll('input,select,textarea');
  const data={};
  inputs.forEach(el=>{if(el.id)data[el.id]=el.value});
  data.history=[];
  document.querySelectorAll('#historyTable tr[data-row]').forEach(tr=>{
    data.history.push({from:tr.querySelector('[name=from]').value,to:tr.querySelector('[name=to]').value,activity:tr.querySelector('[name=activity]').value,loc:tr.querySelector('[name=loc]').value,emp:tr.querySelector('[name=emp]').value});
  });
  data.military=[];
  document.querySelectorAll('#militaryTable tr[data-row]').forEach(tr=>{
    data.military.push({from:tr.querySelector('[name=from]').value,to:tr.querySelector('[name=to]').value,rank:tr.querySelector('[name=rank]').value,unit:tr.querySelector('[name=unit]').value,country:tr.querySelector('[name=country]').value});
  });
  data.addresses=[];
  document.querySelectorAll('#addressTable tr[data-row]').forEach(tr=>{
    data.addresses.push({from:tr.querySelector('[name=from]').value,to:tr.querySelector('[name=to]').value,street:tr.querySelector('[name=street]').value,city:tr.querySelector('[name=city]').value,region:tr.querySelector('[name=region]').value,postal:tr.querySelector('[name=postal]').value,country:tr.querySelector('[name=country]').value});
  });
  return data;
}
function populateData(data){
  for(const k in data){if(document.getElementById(k))document.getElementById(k).value=data[k];}
  document.querySelectorAll('#historyTable tr[data-row]').forEach(tr=>tr.remove());
  (data.history||[]).forEach(h=>addHistory(h));
  document.querySelectorAll('#militaryTable tr[data-row]').forEach(tr=>tr.remove());
  (data.military||[]).forEach(m=>addMilitary(m));
  document.querySelectorAll('#addressTable tr[data-row]').forEach(tr=>tr.remove());
  (data.addresses||[]).forEach(a=>addAddress(a));
}
function save(){
  const uid=document.getElementById('userId').value.trim();
  if(!uid){alert('ادخل المعرّف');return;}
  localStorage.setItem('imm5669_'+uid,JSON.stringify(collectData()));
  alert('تم الحفظ');
  listSaves();
}
function load(){
  const uid=document.getElementById('userId').value.trim();
  const raw=localStorage.getItem('imm5669_'+uid);
  if(raw)populateData(JSON.parse(raw)); else alert('لا بيانات');
}
function listSaves(){
  const div=document.getElementById('savedList');div.innerHTML='';
  Object.keys(localStorage).filter(k=>k.startsWith('imm5669_')).forEach(k=>{
    const btn=document.createElement('button');btn.textContent='تحميل '+k.replace('imm5669_','');btn.onclick=()=>populateData(JSON.parse(localStorage.getItem(k)));
    div.appendChild(btn);
  });
}
function addHistory(h={}){
  const tr=document.createElement('tr');tr.setAttribute('data-row','1');
  tr.innerHTML=`<td><input name=from value='${h.from||''}'></td><td><input name=to value='${h.to||''}'></td><td><input name=activity value='${h.activity||''}'></td><td><input name=loc value='${h.loc||''}'></td><td><input name=emp value='${h.emp||''}'></td><td><button onclick="this.closest('tr').remove()">×</button></td>`;
  document.getElementById('historyTable').appendChild(tr);
}
function addMilitary(m={}){
  const tr=document.createElement('tr');tr.setAttribute('data-row','1');
  tr.innerHTML=`<td><input name=from value='${m.from||''}'></td><td><input name=to value='${m.to||''}'></td><td><input name=rank value='${m.rank||''}'></td><td><input name=unit value='${m.unit||''}'></td><td><input name=country value='${m.country||''}'></td><td><button onclick="this.closest('tr').remove()">×</button></td>`;
  document.getElementById('militaryTable').appendChild(tr);
}
function addAddress(a={}){
  const tr=document.createElement('tr');tr.setAttribute('data-row','1');
  tr.innerHTML=`<td><input name=from value='${a.from||''}'></td><td><input name=to value='${a.to||''}'></td><td><input name=street value='${a.street||''}'></td><td><input name=city value='${a.city||''}'></td><td><input name=region value='${a.region||''}'></td><td><input name=postal value='${a.postal||''}'></td><td><input name=country value='${a.country||''}'></td><td><button onclick="this.closest('tr').remove()">×</button></td>`;
  document.getElementById('addressTable').appendChild(tr);
}
document.getElementById('addHistory').onclick=()=>addHistory();
document.getElementById('addMilitary').onclick=()=>addMilitary();
document.getElementById('addAddress').onclick=()=>addAddress();
document.getElementById('saveBtn').onclick=save;
document.getElementById('loadBtn').onclick=load;
listSaves();

// PDF and Word export
function loadScript(src){return new Promise((res,rej)=>{const s=document.createElement('script');s.src=src;s.onload=res;s.onerror=rej;document.head.appendChild(s);});}

document.getElementById('exportPdf').onclick=async()=>{
  if(!window.html2pdf){await loadScript('https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.3/html2pdf.bundle.min.js');}
  const node=document.getElementById('formContainer').cloneNode(true);
  node.querySelectorAll('button,#userId').forEach(el=>el.remove());
  await html2pdf().set({margin:0.3,filename:'imm5669.pdf',image:{type:'jpeg',quality:0.98},html2canvas:{scale:2},jsPDF:{unit:'in',format:'a4',orientation:'portrait'}}).from(node).save();
};

document.getElementById('exportDoc').onclick=()=>{
  const node=document.getElementById('formContainer').cloneNode(true);
  node.querySelectorAll('button,#userId').forEach(el=>el.remove());
  const html='<!doctype html><html><head><meta charset="utf-8"></head><body>'+node.innerHTML+'</body></html>';
  const blob=new Blob([html],{type:'application/msword'});
  const a=document.createElement('a');a.href=URL.createObjectURL(blob);a.download='imm5669.doc';a.click();
};

document.getElementById('exportJson').onclick=()=>{
  const data=collectData();
  const blob=new Blob([JSON.stringify(data,null,2)],{type:'application/json'});
  const a=document.createElement('a');a.href=URL.createObjectURL(blob);a.download='imm5669.json';a.click();
};
</script>
</body>
</html>
